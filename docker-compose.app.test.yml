version: '3.8'

# Test override: Pull images from GitHub Container Registry instead of building
# Usage: docker-compose -f docker-compose.infrastructure.yml -f docker-compose.app.yml -f docker-compose.app.test.yml up -d
# Set environment variables:
#   - DOCKER_REGISTRY=ghcr.io (default)
#   - GITHUB_REPOSITORY=owner/repo-name (e.g., username/TicketBrokerSpring)
#   - IMAGE_TAG=latest or v1.0.0 (default: latest)
#   - SPRING_PROFILES_ACTIVE=dev (default: dev for testing)
#   - POSTGRES_DEV_PASSWORD=your_dev_password

services:
  ticketbroker-api:
    # Test: pull from registry (no build)
    # Override build by not specifying it - docker-compose will use image only
    image: ${DOCKER_REGISTRY:-ghcr.io}/${GITHUB_REPOSITORY:-owner/ticketbrokerspring}-backend:${IMAGE_TAG:-latest}
    pull_policy: always
    environment:
      # Spring Profile - set to 'dev' for testing (or 'prod' if testing production)
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE:-dev}
      # Database credentials for dev profile
      POSTGRES_DEV_PASSWORD: ${POSTGRES_DEV_PASSWORD:-raspberry}
      # Database credentials for prod profile (if testing prod)
      POSTGRES_PROD_PASSWORD: ${POSTGRES_PROD_PASSWORD:-prod_password_change_me}

  ticketbroker-frontend:
    # Test: pull from registry (no build)
    # Override build by not specifying it - docker-compose will use image only
    image: ${DOCKER_REGISTRY:-ghcr.io}/${GITHUB_REPOSITORY:-owner/ticketbrokerspring}-frontend:${IMAGE_TAG:-latest}
    pull_policy: always
